!function(e){e.fn.swapClass=function(e,t){return this.removeClass(e).addClass(t)},e.fn.switchClass=function(e,t){return this.hasClass(e)?this.swapClass(e,t):this.swapClass(t,e)},e.fn.treeview=function(t){var s={method:"POST",datatype:"json",url:!1,cbiconpath:"./css/images/icons/",icons:["checkbox_0.gif","checkbox_1.gif","checkbox_2.gif"],showcheck:!1,oncheckboxclick:!1,onnodeclick:!1,cascadecheck:!0,data:null,clicktoggle:!0,theme:"bbit-tree-arrows"};e.extend(s,t);var i=s.data,n=e(this),l=n.attr("id");null!=l&&""!=l||(l="bbtree"+(new Date).getTime(),n.attr("id",l));var a=[];if(function(e,t){if(t.push("<div class='bbit-tree-bwrap'>"),t.push("<div class='bbit-tree-body'>"),t.push("<ul class='bbit-tree-root ",s.theme,"'>"),e&&e.length>0)for(var n=e.length,l=0;l<n;l++)o(e[l],t,0,l,l==n-1);else u(null,!1,function(e){if(e&&e.length>0){i=e,s.data=e;for(var n=e.length,l=0;l<n;l++)o(e[l],t,0,l,l==n-1)}});t.push("</ul>"),t.push("</div>"),t.push("</div>")}(s.data,a),n.addClass("bbit-tree").html(a.join("")),f(n),a=null,s.showcheck)for(var c=0;c<3;c++){(new Image).src=s.cbiconpath+s.icons[c]}function o(e,t,i,n,a){var c=e.id.replace(/[^\w]/gi,"_");t.push("<li class='bbit-tree-node'>"),t.push("<div id='",l,"_",c,"' tpath='",n,"' unselectable='on' ");var r=[];if(r.push("bbit-tree-node-el"),e.hasChildren?r.push(e.isexpand?"bbit-tree-node-expanded":"bbit-tree-node-collapsed"):r.push("bbit-tree-node-leaf"),e.classes&&r.push(e.classes),t.push(" class='",r.join(" "),"'>"),t.push("<span class='bbit-tree-node-indent'>"),1==i)t.push("<img class='bbit-tree-icon' src='"+s.cbiconpath+"s.gif'/>");else if(i>1){t.push("<img class='bbit-tree-icon' src='"+s.cbiconpath+"s.gif'/>");for(var h=1;h<i;h++)t.push("<img class='bbit-tree-elbow-line' src='"+s.cbiconpath+"/s.gif'/>")}if(t.push("</span>"),r.length=0,e.hasChildren?e.isexpand?r.push(a?"bbit-tree-elbow-end-minus":"bbit-tree-elbow-minus"):r.push(a?"bbit-tree-elbow-end-plus":"bbit-tree-elbow-plus"):r.push(a?"bbit-tree-elbow-end":"bbit-tree-elbow"),t.push("<img class='bbit-tree-ec-icon ",r.join(" "),"' src='"+s.cbiconpath+"s.gif'/>"),t.push("<img class='bbit-tree-node-icon' src='"+s.cbiconpath+"s.gif'/>"),s.showcheck&&e.showcheck&&(null!=e.checkstate&&void 0!=e.checkstate||(e.checkstate=0),t.push("<img  id='",l,"_",c,"_cb' class='bbit-tree-node-cb' src='",s.cbiconpath,s.icons[e.checkstate],"'/>")),t.push("<a hideFocus class='bbit-tree-node-anchor' tabIndex=1 href='javascript:void(0);'>"),t.push("<span unselectable='on'>",e.text,"</span>"),t.push("</a>"),t.push("</div>"),e.hasChildren)if(e.isexpand){if(t.push("<ul  class='bbit-tree-node-ct'  style='z-index: 0; position: static; visibility: visible; top: auto; left: auto;'>"),e.ChildNodes)for(var b=e.ChildNodes.length,d=0;d<b;d++)e.ChildNodes[d].parent=e,o(e.ChildNodes[d],t,i+1,n+"."+d,d==b-1);t.push("</ul>")}else t.push("<ul style='display:none;'></ul>");t.push("</li>"),e.render=!0}function r(e){for(var t=e.split("."),s=i,n=0;n<t.length;n++)s=0==n?s[t[n]]:s.ChildNodes[t[n]];return s}function h(t,i,n){var a=t.checkstate;if(1==n)t.checkstate=i;else{for(var c=t.ChildNodes,o=c.length,r=!0,h=0;h<o;h++)if(1==i&&1!=c[h].checkstate||0==i&&0!=c[h].checkstate){r=!1;break}t.checkstate=r?i:2}if(t.render&&a!=t.checkstate){var b=t.id.replace(/[^\w]/gi,"_"),d=e("#"+l+"_"+b+"_cb");1==d.length&&d.attr("src",s.cbiconpath+s.icons[t.checkstate])}}function b(t){var i=e(this).attr("tpath"),n=t.target||t.srcElement,a=r(i);if("IMG"==n.tagName){if(e(n).hasClass("bbit-tree-elbow-plus")||e(n).hasClass("bbit-tree-elbow-end-plus")){var c=e(this).next();if(c.hasClass("bbit-tree-node-ct"))c.show();else{var o=i.split(".").length;a.complete?null!=a.ChildNodes&&d(a.ChildNodes,o,i,c,a):(e(this).addClass("bbit-tree-node-loading"),u(a,!0,function(e){a.complete=!0,a.ChildNodes=e,d(e,o,i,c,a)}))}e(n).hasClass("bbit-tree-elbow-plus")?e(n).swapClass("bbit-tree-elbow-plus","bbit-tree-elbow-minus"):e(n).swapClass("bbit-tree-elbow-end-plus","bbit-tree-elbow-end-minus"),e(this).swapClass("bbit-tree-node-collapsed","bbit-tree-node-expanded")}else if(e(n).hasClass("bbit-tree-elbow-minus")||e(n).hasClass("bbit-tree-elbow-end-minus"))e(this).next().hide(),e(n).hasClass("bbit-tree-elbow-minus")?e(n).swapClass("bbit-tree-elbow-minus","bbit-tree-elbow-plus"):e(n).swapClass("bbit-tree-elbow-end-minus","bbit-tree-elbow-end-plus"),e(this).swapClass("bbit-tree-node-expanded","bbit-tree-node-collapsed");else if(e(n).hasClass("bbit-tree-node-cb")){var b=1!=a.checkstate?1:0,p=!0;s.oncheckboxclick&&(p=s.oncheckboxclick.call(n,a,b)),0!=p&&(s.cascadecheck?(function e(t,s,i){if(0!=t(s,i,1)&&null!=s.ChildNodes&&s.ChildNodes.length>0)for(var n=s.ChildNodes,l=0,a=n.length;l<a;l++)e(t,n[l],i)}(h,a,b),function(e,t,s){for(var i=t.parent;i&&!1!==e(i,s,0);)i=i.parent}(h,a,b)):h(a,b,1))}}else{if(s.citem){var f=s.citem.id.replace(/[^\w]/gi,"_");e("#"+l+"_"+f).removeClass("bbit-tree-selected")}s.citem=a,e(this).addClass("bbit-tree-selected"),s.onnodeclick&&(a.expand||(a.expand=function(){(function(){var t=this.id.replace(/[^\w]/gi,"_"),s=e("#"+l+"_"+t+" img.bbit-tree-ec-icon");s.length>0&&s.click()}).call(a)}),s.onnodeclick.call(this,a))}}function d(e,t,s,i,n){var l=e.length;if(l>0){for(var a=[],c=0;c<l;c++)e[c].parent=n,o(e[c],a,t,s+"."+c,c==l-1);i.html(a.join("")),a=null,f(i)}i.addClass("bbit-tree-node-ct").css({"z-index":0,position:"static",visibility:"visible",top:"auto",left:"auto",display:""}),i.prev().removeClass("bbit-tree-node-loading")}function u(t,i,n){if(s.url){if(t&&null!=t)var l=(a=t,[{name:"id",value:encodeURIComponent(a.id)},{name:"text",value:encodeURIComponent(a.text)},{name:"value",value:encodeURIComponent(a.value)},{name:"checkstate",value:a.checkstate}]);e.ajax({type:s.method,url:s.url,data:l,async:i,dataType:s.datatype,success:n,error:function(e){alert("error occur!")}})}var a}function p(){e(this).hover(function(){e(this).addClass("bbit-tree-node-over")},function(){e(this).removeClass("bbit-tree-node-over")}).click(b).find("img.bbit-tree-ec-icon").each(function(t){e(this).hasClass("bbit-tree-elbow")||e(this).hover(function(){e(this).parent().addClass("bbit-tree-ec-over")},function(){e(this).parent().removeClass("bbit-tree-ec-over")})})}function f(t){e("li.bbit-tree-node>div",t).each(p)}function v(e,t,s){for(var i=0,n=e.length;i<n;i++)1==e[i].showcheck&&1==e[i].checkstate&&t.push(s(e[i])),null!=e[i].ChildNodes&&e[i].ChildNodes.length>0&&v(e[i].ChildNodes,t,s)}return n[0].t={getSelectedNodes:function(e){var t=[];return e?function e(t,s,i){for(var n=0,l=t.length;n<l;n++)1==t[n].showcheck&&(1==t[n].checkstate||2==t[n].checkstate)&&s.push(i(t[n])),null!=t[n].ChildNodes&&t[n].ChildNodes.length>0&&e(t[n].ChildNodes,s,i)}(i,t,function(e){return e}):v(i,t,function(e){return e}),t},getSelectedValues:function(){var e=[];return v(i,e,function(e){return e.value}),e},getCurrentItem:function(){return s.citem},reflash:function(t){!function(t){var s=t.replace(/[^\w-]/gi,"_"),i=e("#"+l+"_"+s);if(i.length>0){i.addClass("bbit-tree-node-loading");var n=i.hasClass("bbit-tree-elbow-end")||i.hasClass("bbit-tree-elbow-end-plus")||i.hasClass("bbit-tree-elbow-end-minus"),a=i.attr("tpath"),c=a.split(".").length,h=r(a);h&&u(h,!0,function(e){h.complete=!0,h.ChildNodes=e,h.isexpand=!0,e&&e.length>0?h.hasChildren=!0:h.hasChildren=!1;var t=[];o(h,t,c-1,a,n),t.shift(),t.pop();var s=i.parent();s.html(t.join("")),t=null,f(s),p.call(s.find(">div"))})}}("string"==typeof t?t:t.id)}},n},e.fn.getCheckedNodes=function(){return this[0].t?this[0].t.getSelectedValues():null},e.fn.getTSNs=function(e){return this[0].t?this[0].t.getSelectedNodes(e):null},e.fn.getCurrentNode=function(){return this[0].t?this[0].t.getCurrentItem():null},e.fn.reflash=function(e){if(this[0].t)return this[0].t.reflash(e)}}(jQuery);