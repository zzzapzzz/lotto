<?xml version="1.0" encoding="UTF-8"?>  
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">  
  
<mapper namespace="userAuthMapper">

	<select id="userLogin" statementType="CALLABLE" parameterType="java.util.Map" resultType="org.apache.commons.collections.map.CaseInsensitiveMap">
		{CALL PW_LOGIN (#{user_id}, #{user_pwd}, #{user_ip})} 
	</select>
	
	<select id="getUserInfo" parameterType="java.util.Map" resultType="com.lotto.spring.domain.dao.UserSession">
		SELECT 
			  usr_id
			, usr_nm
			, usr_thwd
			, store_type
			, dbo.f_getCodeName('C000000001', store_type) as store_type_nm
			, store_desc
			, cost_centre_code
			, ship_to_code			
			, login_tm
			, login_ip
			, login_fail_cnt
			, isnull(use_yn, 'N') use_yn
			, CASE 
				WHEN isnull(use_yn, 'N') = 'Y' THEN '사용'
				ELSE '미사용'
			  END use_yn_nm 
			, thwd_q
			, thwd_a
			, email
			, email_chk_yn
			, email_chk_tm
			, auth_task
			, dbo.f_getAuthNm(auth_task) auth_task_nm
			, auth_menu
			, dbo.f_getAuthNm(auth_menu) auth_menu_nm
			, cr_dt
			, up_dt
		FROM TB_USER_INFO		
		WHERE usr_id = #{usr_id}
	</select>
	
	<!-- 사용자별 메뉴접근 URL 정보 조회 -->
	<select id="getMenuAuthUrlList" resultType="org.apache.commons.collections.map.CaseInsensitiveMap" parameterType="java.lang.String">
		select tmi.menu_id
				, tmi.p_menu_id
				, tmi.menu_nm
		        , CASE 
					WHEN tmi.p_menu_id = 0 THEN 'P'
					ELSE 'C'
		          END as m_type
		        , tmi.menu_url
		        , tmi.lna_element
		from tb_menu_info tmi
		<if test='usr_id != null and usr_id != "smlotto"'>
		inner join (
			select auth_cd, menu_id
			from tb_menu_authinfo
			where use_yn = 'Y'
			and auth_cd = (
							SELECT auth_task 
		                    FROM TB_USER_INFO
		                    WHERE usr_id = #{usr_id}
							)
		) tmai ON tmai.menu_id = tmi.menu_id
		</if>
		where tmi.menu_id != 0
		order by tmi.menu_id
	</select>
	
</mapper>